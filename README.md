# Cloudflare å„ªé¸ IP æ¸¬é€Ÿå¹³å° (CF-IP-SpeedTest-Cloud)

åŸºæ–¼ Cloudflare Worker èˆ‡ KV Storage æ§‹å»ºçš„è‡ªå‹•åŒ–å„ªé¸ IP æ”¶é›†ã€æ¸¬é€Ÿèˆ‡åˆ†ç™¼å¹³å°ã€‚
é›†æˆäº†å¾Œç«¯è‡ªå‹•æ¸¬é€Ÿã€ç€è¦½å™¨ç«¯çœŸå¯¦å»¶é²æ¸¬è©¦ã€ä»¥åŠå¯è¦–åŒ–çš„ç®¡ç†å¾Œå°ã€‚

> **ç•¶å‰ç‰ˆæœ¬**: V3.3.8

![License](https://img.shields.io/badge/license-MIT-green)
![Version](https://img.shields.io/badge/version-3.3.8-blue)

## ğŸ“¸ ä»‹é¢é è¦½

*(è«‹åœ¨ä¸‹æ–¹è²¼ä¸Šæ‚¨çš„ç¶²é æˆªåœ–)*

<!-- ğŸ’¡ è«‹åœ¨ GitHub ç·¨è¼¯æ¨¡å¼ä¸‹ï¼ŒæŠŠæ‚¨çš„æˆªåœ–ç›´æ¥ã€Œè¤‡è£½è²¼ä¸Š (Ctrl+V)ã€åˆ°é€™è¡Œæ–‡å­—çš„ä¸‹æ–¹ï¼ŒGitHub æœƒè‡ªå‹•ç”Ÿæˆåœ–ç‰‡é€£çµï¼ -->
<img width="1374" height="1057" alt="image" src="https://github.com/user-attachments/assets/871dc37b-0993-44a0-85ec-d60482d9fc9c" />
<img width="1352" height="653" alt="image" src="https://github.com/user-attachments/assets/21a75446-c01e-4fd1-9112-be7e9f4cf74a" />




---

## âœ¨ ä¸»è¦åŠŸèƒ½

*   **ğŸŒ å…¨çƒæ©Ÿæˆ¿ä¸­æ–‡åŒ– (V3.3.8)**: å…§å»ºå…¨çƒé«˜é” 200+ å€‹ Cloudflare æ©Ÿæˆ¿ä»£ç¢¼ (å¦‚ HKG, TPE, LAX, SJC, SLC ç­‰) è‡ªå‹•è½‰æ›ç‚ºç¹é«”ä¸­æ–‡åŸå¸‚åï¼ŒAPIã€ä¸‹è¼‰æ–‡ä»¶èˆ‡ç·šä¸ŠæŸ¥çœ‹å…¨é¢åŒæ­¥æ”¯æ´ã€‚
*   **ğŸ¨ ç¾ä»£åŒ– UI è¨­è¨ˆ**:
    *   **ç²¾ç°¡å„€è¡¨æ¿**: è‡ªå‹•æ¯ 5 ç§’åˆ·æ–° HTTP é€£é€šæ€§æ¸¬è©¦ (GitHub, OpenAI, Bilibili, æ·˜å¯¶ç­‰)ï¼Œå³æ™‚æŒæ¡åœ‹å…§å¤–ç¶²è·¯ç‹€æ³ã€‚
    *   **å¤šå½©ç¨ç«‹æŒ‰éˆ•**: æ¸…æ™°çš„åŠŸèƒ½åˆ†å€èˆ‡è¦–è¦ºå„ªåŒ–ï¼ŒåŒ…å«é†’ç›®çš„æ·±ç²‰ç´… ITDog æŒ‰éˆ•ã€‚
    *   **å…¨åŸŸç†±éµæ”¯æ´**: é–å®šç•«é¢åªéœ€æŒ‰ `Enter` å³å¯ä¸€éµç™»å…¥ã€‚
*   **â˜ï¸ è‡ªå‹•åŒ–å¾Œç«¯æ›´æ–°**: åˆ©ç”¨ Cron Triggers å®šæ™‚å¾å¤–éƒ¨æ•¸æ“šæºæ‹‰å– IP ä¸¦åœ¨ Worker å¾Œç«¯é€²è¡Œå¯ç”¨æ€§æ¸¬è©¦ã€‚
*   **âš¡ ç€è¦½å™¨ç«¯çœŸå¯¦æ¸¬é€Ÿ**: åœ¨ç®¡ç†å¾Œå°ç›´æ¥é€²è¡Œç€è¦½å™¨ç«¯çš„çœŸå¯¦å»¶é²æ¸¬è©¦ï¼Œçµæœæœ€è²¼è¿‘ç”¨æˆ¶ç•¶å‰ç¶²è·¯å¯¦éš›é«”é©—ã€‚
*   **ğŸ“¡ æ™ºèƒ½è·¯ç”±ç³»çµ±**: æ”¯æ´å­åŸŸåè·¯ç”±ï¼Œè¨ªå•ä¸åŒå­åŸŸåè‡ªå‹•è¿”å›å°æ‡‰æ•¸æ“šï¼ˆç„¡éœ€ Token å³å¯å…¬é–‹è¨‚é–±ï¼‰ï¼š
    *   `fast.xxx` / `fast-xxx`: è¿”å›å¾Œç«¯æ¸¬é€Ÿç¯©é¸çš„å„ªé¸ IP
    *   `browser.xxx` / `web.xxx`: è¿”å›ç€è¦½å™¨ç«¯å¯¦æ¸¬çš„å„ªé¸ IP
    *   `all.xxx` / `ips.xxx`: è¿”å›å®Œæ•´çš„ IP åº«
*   **ğŸ” æ™ºæ…§å®‰å…¨ç®¡ç†**: 
    *   æ”¯æ´å¯†ç¢¼ç™»å…¥ä¿è­·èˆ‡ Token æ¬Šé™ç®¡ç†ã€‚
    *   **å¯†ç¢¼è¨˜æ†¶å„ªåŒ–**: ç™»å‡ºå¾Œè‡ªå‹•ä¿ç•™å¯†ç¢¼è¼¸å…¥ï¼Œé‡ç™»æ›´æ–¹ä¾¿ã€‚
*   **ğŸ”Œ ä¾¿æ· API é›†æˆ**: æä¾›ç´”æ·¨çš„ API é€£çµè¤‡è£½åŠŸèƒ½ï¼Œæ–¹ä¾¿ä¸€éµå°å…¥ Surge, Clash, Sing-box ç­‰ä»£ç†å·¥å…·ã€‚
*   **ğŸ“Š ç«¯å£è³‡è¨Šé¡¯ç¤º**: ä¸»é é¢æ¸…æ™°åˆ—å‡º Cloudflare æ”¯æ´çš„ HTTP/HTTPS ç«¯å£ã€‚

## ğŸ› ï¸ éƒ¨ç½²æŒ‡å—

### 1. æº–å‚™å·¥ä½œ
*   ä¸€å€‹ Cloudflare å¸³è™Ÿ
*   ä¸€å€‹è¨—ç®¡åœ¨ Cloudflare ä¸Šçš„åŸŸå

### 2. å‰µå»º KV Namespace
åœ¨ Cloudflare Dashboard ä¸­ï¼š
1.  é€²å…¥ **Workers & Pages** -> **KV**.
2.  å‰µå»ºä¸€å€‹æ–°çš„ Namespaceï¼Œå‘½åç‚º `cloudflare_ips` (æˆ–å…¶ä»–ä½ å–œæ­¡çš„åå­—)ã€‚

### 3. å‰µå»º Worker
1.  å‰µå»ºä¸€å€‹æ–°çš„ Workerã€‚
2.  å°‡æœ¬å°ˆæ¡ˆçš„ `worker.js` ä»£ç¢¼å®Œæ•´è¤‡è£½é€²å»ã€‚
3.  åœ¨ Worker çš„ **Settings** -> **Variables** ä¸­ç¶å®š KVï¼š
    *   **Variable name**: `IP_STORAGE`
    *   **KV Namespace**: é¸æ“‡å‰›å‰›å‰µå»ºçš„ `cloudflare_ips`

### 4. è¨­ç½®ç’°å¢ƒè®Šæ•¸
åœ¨ Worker çš„ **Settings** -> **Variables** -> **Environment Variables** ä¸­æ·»åŠ ï¼š

| è®Šæ•¸åç¨± | æè¿° | ç¯„ä¾‹ |
| :--- | :--- | :--- |
| `ADMIN_PASSWORD` | **(å¿…å¡«)** ç®¡ç†å¾Œå°çš„ç™»å…¥å¯†ç¢¼ | `MySuperSecretPass123` |

### 5. è¨­ç½®è§¸ç™¼å™¨ (Cron Triggers)
ç‚ºäº†è®“å¾Œç«¯è‡ªå‹•æ›´æ–° IP åº«ï¼Œè«‹è¨­ç½®å®šæ™‚ä»»å‹™ï¼š
1.  é€²å…¥ **Settings** -> **Triggers**.
2.  é»æ“Š **Add Cron Trigger**.
3.  å»ºè­°è¨­ç½®ç‚ºæ¯ 4 å°æ™‚æˆ–æ¯å¤©åŸ·è¡Œä¸€æ¬¡ï¼ˆä¾‹å¦‚ `0 */4 * * *`ï¼‰ã€‚

### 6. è¨­ç½® DNS èˆ‡å­åŸŸå (é‡è¦) ğŸš€
ç‚ºäº†å•Ÿç”¨ **æ™ºèƒ½è·¯ç”±** èˆ‡ **å…¬é–‹ API** åŠŸèƒ½ï¼Œè«‹åœ¨æ‚¨çš„åŸŸå DNS è¨­å®šä¸­æ–°å¢ä»¥ä¸‹ CNAME è¨˜éŒ„ï¼Œå…¨éƒ¨æŒ‡å‘æ‚¨çš„ Worker åœ°å€ (ä¾‹å¦‚ `your-worker.username.workers.dev`)ï¼š

| é¡å‹ | åç¨± (Host) | ç›®æ¨™ (Target) | ç”¨é€” |
| :--- | :--- | :--- | :--- |
| CNAME | `admin` | `your-worker.workers.dev` | ç®¡ç†å¾Œå°å…¥å£ |
| CNAME | `fast` | `your-worker.workers.dev` | ç²å–å¾Œç«¯å„ªé¸ IP (API) |
| CNAME | `browser` | `your-worker.workers.dev` | ç²å–æœ¬æ©Ÿæ¸¬é€Ÿçµæœ (API) |
| CNAME | `all` | `your-worker.workers.dev` | ç²å–å®Œæ•´ IP åº« (API) |

> **æ³¨æ„**ï¼šè¨­å®šå®Œæˆå¾Œï¼Œè«‹åœ¨ Worker çš„ **Settings** -> **Triggers** -> **Custom Domains** ä¸­ï¼Œå°‡ä¸Šè¿°åŸŸåï¼ˆå¦‚ `fast.yourdomain.com`ï¼‰å…¨éƒ¨ç¶å®šåˆ°æ­¤ Workerã€‚

---

## ğŸ“– ä½¿ç”¨èªªæ˜

### é€²å…¥ç®¡ç†å¾Œå°
è¨ªå• `https://admin.yourdomain.com` (æˆ–æ˜¯æ‚¨ç¶å®šçš„ä¸»åŸŸå)ï¼Œè¼¸å…¥ `ADMIN_PASSWORD` ç™»å…¥ã€‚

*   **ç«‹å³æ›´æ–°åº«**: æ‰‹å‹•è§¸ç™¼å¾Œç«¯æ›´æ–° IP åˆ—è¡¨ã€‚
*   **ç€è¦½å™¨æ¸¬é€Ÿ**: é»æ“Šå¾Œæœƒå°éš¨æ©ŸæŠ½å–çš„ IP é€²è¡Œæœ¬åœ° Ping æ¸¬è©¦ã€‚æ¸¬é€Ÿå®Œæˆå¾Œï¼Œçµæœæœƒè‡ªå‹•åŒæ­¥è‡³é›²ç«¯ (`browser.xxx` å³å¯è®€å–)ã€‚
*   **Token ç®¡ç†**: ç”¨æ–¼ç”Ÿæˆ API å¯«å…¥æ¬Šé™çš„ Token (è®€å–æ•¸æ“šä¸éœ€è¦ Token)ã€‚
*   **è¤‡è£½é€£çµ**: ä¸‹æ‹‰é¸å–®å¯å¿«é€Ÿè¤‡è£½ `fast`, `browser`, `all` çš„ç´”æ·¨è¨‚é–±é€£çµã€‚

### API æ¥å£ (å…¬é–‹è®€å–)
ç„¡éœ€ Token å³å¯è¨ªå•ä»¥ä¸‹åœ°å€ç²å–ç´”æ–‡æœ¬æ•¸æ“šï¼ˆé©åˆæ”¾å…¥è¨‚é–±è½‰æ›å™¨ï¼‰ï¼š

*   `https://fast.yourdomain.com` -> å¾Œç«¯è‡ªå‹•å„ªé¸ IP
*   `https://browser.yourdomain.com` -> ç€è¦½å™¨å¯¦æ¸¬å„ªé¸ IP
*   `https://all.yourdomain.com` -> æ‰€æœ‰ IP åˆ—è¡¨

*æ”¯æ´åƒæ•¸*: `?format=ip` (åƒ…è¼¸å‡ºç´” IPï¼Œä¸å¸¶æ©Ÿæˆ¿åç¨±èˆ‡å»¶é²å‚™è¨»)

---

## ğŸ“¸ æ”¯æ´ç«¯å£
ç³»çµ±ä¸»é å·²å…§ç½® Cloudflare æ”¯æ´çš„ç«¯å£åˆ—è¡¨æç¤ºï¼š
*   **HTTP**: 80, 8080, 8880, 2052, 2082, 2086, 2095
*   **HTTPS**: 443, 2053, 2083, 2087, 2096, 8443

---

## ğŸ™ è‡´è¬ (Credits)
æœ¬å°ˆæ¡ˆåŸºæ–¼é–‹æºç¤¾ç¾¤çš„å„ªç§€å°ˆæ¡ˆé€²è¡ŒäºŒæ¬¡é–‹ç™¼èˆ‡åŠŸèƒ½å¢å¼·ï¼š

*   **æ ¸å¿ƒä»£ç¢¼åŸºç¤**: [ethgan/CF-Worker-BestIP-collector](https://github.com/ethgan/CF-Worker-BestIP-collector) - æ„Ÿè¬åŸä½œè€…æä¾›çš„åŸºç¤ Worker æ¶æ§‹èˆ‡æ€è·¯ã€‚
*   **IP æ•¸æ“šä¾†æº**: [cmliu/cmliu](https://github.com/cmliu/cmliu) - æ„Ÿè¬å¤§ä½¬æ•´ç†èˆ‡ç¶­è­·çš„ Cloudflare CIDR åˆ—è¡¨ã€‚

## âš ï¸ å…è²¬è²æ˜
æœ¬é …ç›®åƒ…ä¾›å­¸ç¿’èˆ‡æŠ€è¡“ç ”ç©¶ä½¿ç”¨ã€‚è«‹å‹¿å°‡å…¶ç”¨æ–¼ä»»ä½•éæ³•ç”¨é€”ã€‚IP ä¾†æºå–è‡ªç¶²çµ¡å…¬é–‹è³‡æºï¼Œæœ¬é …ç›®ä¸ä¿è­‰ IP çš„å¯ç”¨æ€§èˆ‡é€Ÿåº¦ã€‚

---
*Based on CF-Worker-BestIP-collector V3.3.8*
